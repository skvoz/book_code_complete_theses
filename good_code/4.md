#Защитное программирование
## **[Контрольные вопросы](../control_list/defence_coding.md)**
## **Эвристика**
Защитное программирование прекрасно дополняет другие способы повышения качества программ. Итеративное проектирование
, написание псевдокода и тестов до начала кодирования,и низкоуровневая проверка соответствия проекту - 
это все что помогает избежать добавления дефектов
##**Ключевые моменты**
- **Главная идея** если методу предоставлены некоректные данные , даже испорченные другой программой ,
его работа не нарушиться.
- Промышленный код должен обрабатывать ошибки более изощренно, чем по принципу «мусор на входе — мусор на выходе».
- С помощью технологии защитного программирования ошибки легче находить, легче исправлять, и они наносят меньше
 вреда промышленному коду.
- Утверждения позволяют обнаружить ошибки на ранней стадии, особенно в больших системах, системах повышенной
 надежности и в системах с часто изменяемым кодом.
- Выбор способа обработки некорректных входных данных — это ключевое решение обработки ошибок, принимаемое на этапе 
высокоуровневого проектирования.
- Исключения предоставляют возможность обработки ошибок в измерении, отличном от нормального хода алгоритма. Если
 они используются с осторожностью, то являются важным дополнением в интеллектуальном инструментальном наборе 
 программиста. Применять их следует после сравнения с другими технологиями обработки ошибок.
- Ограничения, применяемые к промышленной версии системы, не обязательно должны относиться и ко времени 
разработки. Пользуясь этим преимуществом, вы можете добавлять в отладочную версию любой код, помогающий быстро 
выявлять ошибки.

##Стратегия защитного программирования ( как это вижу я для php )
- прмышленная версия показывает только те ошибки которые могут возникнуть из за действий юзера
- промышленная версия скрывает непредвиденные ошибки от юзера.
- дев версия показывает все ошибки
- в любой версии обработчик не допускает прерывания работы программы из за ошибок
- дев версия конкретезирует ошибки с помощью механизма "утверждений"
- убедитесь что утверждения завершают работу программы
- если не используется механизм "баррикада" то в методе проверяются **ВСЕ** входящие данные
- для снижения доли кода защитного программирования используется махенизм "баррикады"

##Защита программы от неправильных данных
Хорошая программа не выдает мусор незвисимо от того что у нее было на входе. Вместо этого она использует
следующие стратегии
- мусор на входе - ничего на выходе
- мусор на входе - сообщение об ошибке на выходе
- мусор на входе - не пропускается

Для корректной работы метода требуетсяё
- **Проверка всех данных из внешних источников**
- **Проверка всх входных параметров метода** 

##Утверждения
Утверждения (Assertion) это код используемый во время разработки, с помощью которого программа проверяет правильность
своего выполнения. Утверждения особенно полезны в больших проектах, они позволяют быстрее выявить несоответствия в 
интерфейсах, ошибки вкравшиеся при изменении кода и тд. Утверждения не предназначены для показа в промышленной 
версии , они прменяются в период разработки и поддержки. Полезной практикой есть создание собсвтенного механизма 
утвержденийю

##Спосообы орбаботки ошибок
- вернуть нейтральное значение
- вернуть предупреждающее сообщение
- вернуть код ошибки ( установить значение статусной переменной, вернуть статус, либо сгенерировать исключение)
- вызвать процедуру или обьект обработчик ошибок
- показать сообщение об ошибке где бы она ни случилась
- прекратить выполнение
###Устойчивость против корректности
Обработка ошибок в общем случае может стремится либо к большей устойчивости либо к большей корректности
###Влияние выбора метода обработки ошибок на проектирование выского уровня
Надо старатся одинаково реагировать на ошибки во всей программе. Поминте что даже если вы считаете что ошибка 
в функции возникнуть не может, все равно проверяйте. Весь смысл защитного программирования в защите от ошибок 
которых вы не ожидаете.

##Исключения
Если код в некотором методе встречает неожиданную ситуацию, и не знает как ее обработать, то он генерирует 
исключение, те фактически умывает руки со словами "я не знаю что с этим делать, надеюсь кто нибудь другой знает ,
как на это реагировать.
- основное приимущество исключений в том, что они сигнализируют об ошибке так, что это нельзя проигнорировать
- использовать исключения надо только в тех случаях когда ошибку нельзя обработать прочими средствами
- уровень абстракции исключения и метода должны совпадать
- вносите в исключение всю информацию об его возникновении
- выясните какие исключения генерируют используемая библиотека
- рассмотрите вопрос об централизованом выводе информации об исключениях
- стандартизируйте использования исключений в проекте
    1. Определите случаи в которых код может использовать синтаксис throw-catch для локальной обработки ошибок
    2. Определите случаи в которых код может сгенерировать исключение не перехватываемое локально
    3. Решите будет ли использоваться централизованный генератор сообщений об исключениях
    
##Изоляция повреждений вызванных ошибками
Один из способов изоляции в целях защитного программирования состоит в разработке набора интерфейсов в качестве
оболочки для "безопасных" частей кода. Если данные были проверены открытыми методами класса, закрытые 
методы могу считать что данные безопасны.
###Связь между "баррикадами" и "утверждениями" 
Методы с внешней стороны баррикады должны использовать обработчик ошибок поскольку небезопасно делать любые
предположения о данных. Методы внутри баррикады должны использовать утверждения так как данные переданные им
считаются безопасными. Если один из методов внутри баррикады генерирует ошибку это следует считать ошибкой 
программы а не входных данных.

##Отладочные средства
Будте готовы поступится скоростью и ресурсоемкостью во время разработки в обмен на встроенные средства позволяющие
двигаться процессу разработки более гладко
###Внедряйте отладку как можно раньше
Чем раньше вы добавите отладочные средства тем больше они помогут. Обычно вы не добавляете отладочную информацию,
пока не столкнетесь несколько раз с проблемой. Если же вы внедрите поддержку отладки после первого раза или перенесете
ее из предыдущего проекта, она будет помогать вам на протяжении всей работы.
###Используйте наступательное программирование
Иногда нападение - лучшая защита. Чем жестче трабования во время разработки, тем проще эксплуатация программы.
Некоторые приемы наступательного программирования
- утверждения должны завершать работу программы
- настройте программу на отправку вам журналов ошибок по email
###Запланируйте удаление отладочных средств
- используйте встроенный или напишите свой препроцессор
- используйте отладочные заглушки

##Доля защитного кода в промышленной версии
Во промышленной версии должны быть заметны ошибки пользователя но не ошибки программы.
По этому в промышленнйо версии часть обработчиков следует удалть:
- оставить код с проверкой существенных ошибок
- удалить код проверяющий незначительные ошибки
- удалить код прекращающий работу программы
- оставить код который аккуратно завершает работу программы
- регистрируйте ошибки для отдела техсапорта
- убедитесь что отсавленные сообщения об ошибках дружелюбны

##Зщата от защитного программирования
Если вы проверяете данные передаваемые через параметры, во всех возможных местах и всеми возможными способами
ваша программа будет слишком большой и громоздкой. Подумайте где надо защищаться и соответственно раставте
приоритеты защитного программирования.


